image: composer/composer:latest
pipelines:
  default:
    - step:
        script:
          # Show software versions.
          - composer self-update
          - composer --version
          - php -v

          # Install SSH keys.
          - mkdir -p /root/.ssh
          - chmod 700 /root/.ssh

          - echo "$COMPOSER_PRIVATE_KEY" | sed 's/\\n/\n/g' | cat > /root/.ssh/id_rsa
          - chmod 600 /root/.ssh/id_rsa

          - echo "bitbucket.org,104.192.143.2 ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAubiN81eDcafrgMeLzaFPsw2kNvEcqTKl/VqLat/MaB33pZy0y3rJZtnqwR2qOOvbwKZYKiEO1O6VqNEBxKvJJelCq0dTXWT5pbO2gDXC6h6QDXCaHo6pOHGPUy+YBaGQRGuSusMEASYiWunYN0vCAI8QaXnWMXNMdFP3jHAJH0eDsoiGnLPBlBp4TNm6rYI74nMzgz3B9IikW4WVK+dc8KZJZWYjAuORU3jc1c/NPskD2ASinf8v3xnfXeukU0sJ5N6m5E8VLjObPEO+mN2t/FZTMZLiFqPWc/ALSqnMnnhwrNi2rbfg/rd/IpL8Le3pSBne8+seeFVBoGqzHM9yXw==" >> /root/.ssh/known_hosts

          # Composer installation.
          - echo "$COMPOSER_AUTHENTICATION" > $COMPOSER_HOME/auth.json
          - composer validate --strict --no-interaction
          - export BIN=$(composer config bin-dir)

          - composer require mediact/testing-suite --dev --prefer-dist --no-scripts --ignore-platform-reqs --no-progress --optimize-autoloader --no-interaction  

          # Require the coding standards, if they are not explicitly defined.
          # Execute tests from MediaCT testing bundle
          - $BIN/mediact-testing-suite
